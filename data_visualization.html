<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>P01 - Data visualization</title>

<script src="libs/jquery/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap/js/bootstrap.min.js"></script>
<script src="libs/bootstrap/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/default.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<style type="text/css">
  body {
    padding-top: 20px;
  }
  .navbar-brand {
    font-weight: bold;
  }
  footer {
    border-top: 1px solid #CCC;
    margin-top: 60px;
    margin-bottom: 48px;
    opacity: 0.75;
  }
  .content-body>:first-child, .content-body>:first-child>:first-child {
    margin-top: 0 !important;
  }
  p code {
    white-space: inherit;
  }
</style>

<div class="fluid-row">
  <div class="col-sm-12">
    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <a class="navbar-brand" href="./">P01 - Advanced R</a>
        </div>
      </div>
    </nav>
  </div>
</div>

<div class="fluid-row">
  <div class="col-sm-3">
    <div class="list-group">
      <a class="list-group-item" href="./">Introduction</a>
      <a class="list-group-item" href="refresheR.html">refreshR</a>
      <a class="list-group-item" href="creating_packages.html">Creating R packages</a>
      <a class="list-group-item" href="data_visualization.html">Data visualization</a>
      <a class="list-group-item" href="data_wrangling.html">Data wrangling</a>
      <a class="list-group-item" href="data_linkage.html">Data linkage</a>
      <a class="list-group-item" href="statistical_programming.html">Statistical programming</a>
      <a class="list-group-item" href="zelig.html">Zelig</a>
    </div>
    <script>
      // manage active state of toc based on current page
      var href = window.location.pathname;
      href = href.substr(href.lastIndexOf('/') + 1);
      if (href === "" || href === "index.html")
        href = "./";
      $('a.list-group-item[href="' + href + '"]').addClass('active');
    </script>
  </div>
  <div class="col-sm-9 content-body">


<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#starting-a-the-end">Starting A The End</a></li>
<li><a href="#why-ggplot2">Why <code>ggplot2</code>?</a></li>
<li><a href="#who-not">Who not?</a></li>
<li><a href="#what-is-the-grammar-of-graphics">What Is The Grammar Of Graphics?</a></li>
<li><a href="#example-data-housing-prices">Example Data: <code>Housing prices</code></a></li>
<li><a href="#ggplot2-vs-base-graphics"><code>ggplot2</code> VS Base Graphics</a></li>
<li><a href="#ggplot2-vs-base-for-simple-graphs"><code>ggplot2</code> VS Base for simple graphs</a></li>
<li><a href="#ggplot2-base-graphics-vs-ggplot-for-more-complex-graphs"><code>ggplot2</code> Base graphics VS <code>ggplot</code> for more complex graphs:</a></li>
</ul></li>
<li><a href="#aesthetics">Aesthetics</a><ul>
<li><a href="#aesthetic-mapping">Aesthetic Mapping</a></li>
<li><a href="#geometic-objects-geom">Geometic Objects (<code>geom</code>)</a></li>
<li><a href="#points-scatterplot">Points (Scatterplot)</a></li>
<li><a href="#lines-prediction-line">Lines (Prediction Line)</a></li>
<li><a href="#smoothers">Smoothers</a></li>
<li><a href="#text-label-points">Text (Label Points)</a></li>
<li><a href="#aesthetic-mapping-vs-assignment">Aesthetic Mapping VS Assignment</a></li>
<li><a href="#mapping-variables-to-other-aesthetics">Mapping Variables To Other Aesthetics<a id="sec-2-8" name="sec-2-8"></a></a></li>
<li><a href="#exercise-i">Exercise I</a></li>
</ul></li>
<li><a href="#transformations">Transformations</a><ul>
<li><a href="#statistical-transformations">Statistical Transformations</a></li>
<li><a href="#setting-statistical-transformation-arguments">Setting Statistical Transformation Arguments</a></li>
<li><a href="#changing-the-statistical-transformation">Changing The Statistical Transformation</a></li>
<li><a href="#exercise-ii">Exercise II</a></li>
</ul></li>
<li><a href="#scales">Scales</a><ul>
<li><a href="#scales-controlling-aesthetic-mapping">Scales: Controlling Aesthetic Mapping</a></li>
<li><a href="#common-scale-arguments">Common Scale Arguments</a></li>
<li><a href="#scale-modification-examples">Scale Modification Examples</a></li>
<li><a href="#using-different-color-scales">Using different color scales</a></li>
<li><a href="#available-scales">Available Scales</a></li>
<li><a href="#exercise-ii-1">Exercise II</a></li>
</ul></li>
<li><a href="#faceting">Faceting</a><ul>
<li><a href="#faceting-1">Faceting</a></li>
<li><a href="#what-is-the-trend-in-housing-prices-in-each-state">What is the trend in housing prices in each state?</a></li>
<li><a href="#faceting-to-the-rescue">Faceting to the rescue</a></li>
</ul></li>
<li><a href="#themes">Themes</a><ul>
<li><a href="#themes-1">Themes</a></li>
<li><a href="#overriding-theme-defaults">Overriding theme defaults</a></li>
<li><a href="#creating-and-saving-new-themes">Creating and saving new themes</a></li>
</ul></li>
<li><a href="#the-1-faq">The #1 FAQ</a><ul>
<li><a href="#map-aesthetic-to-different-columns">Map Aesthetic To Different Columns</a></li>
</ul></li>
<li><a href="#dynamic">Dynamic</a><ul>
<li><a href="#a-growing-number-of-libraries">A growing number of libraries</a></li>
</ul></li>
<li><a href="#putting-it-all-together">Putting It All Together</a><ul>
<li><a href="#challenge-recreate-this-economist-graph">Challenge: Recreate This <code>Economist</code> Graph</a></li>
</ul></li>
<li><a href="#challenge-solution">Challenge Solution</a><ul>
<li><a href="#challenge-solution-1">Challenge Solution</a></li>
<li><a href="#challenge-solution-2">Challenge Solution</a></li>
<li><a href="#challenge-solution-3">Challenge Solution</a></li>
</ul></li>
<li><a href="#wrap-up">Wrap-up</a><ul>
<li><a href="#additional-resources">Additional resources</a></li>
</ul></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1>Introduction</h1>
<div id="starting-a-the-end" class="section level2">
<h2>Starting A The End</h2>
<p>Goal: by the end of the session you will be able to reproduce this graphic from the Economist:</p>
<p><img src="images/Economist1.png" alt="img" /></p>
</div>
<div id="why-ggplot2" class="section level2">
<h2>Why <code>ggplot2</code>?</h2>
<p>Advantages of ggplot2</p>
<ul>
<li>consistent underlying <code>grammar of graphics</code> (Wilkinson, 2005)</li>
<li>plot specification at a high level of abstraction</li>
<li>very flexible</li>
<li>theme system for polishing plot appearance</li>
<li>mature and complete graphics system</li>
<li>many users, active mailing list</li>
</ul>
</div>
<div id="who-not" class="section level2">
<h2>Who not?</h2>
<p>That said, there are some things you cannot (or should not) do With ggplot2:</p>
<ul>
<li>3-dimensional graphics (see the rgl package)</li>
<li>Graph-theory type graphs (nodes/edges layout; see the igraph package)</li>
<li>Interactive graphics (see the ggvis package)</li>
</ul>
</div>
<div id="what-is-the-grammar-of-graphics" class="section level2">
<h2>What Is The Grammar Of Graphics?</h2>
<p>Independently specify plot building blocks and combine them to create just about any kind of graphical display you want. Building blocks of a graph include:</p>
<ul>
<li>data</li>
<li>aesthetic mapping</li>
<li>geometric object</li>
<li>statistical transformations</li>
<li>scales</li>
<li>coordinate system</li>
<li>position adjustments</li>
<li>faceting</li>
</ul>
<p>The basic idea is that you specify different parts of the plot, and add them together using the <code>+</code> operator.</p>
</div>
<div id="example-data-housing-prices" class="section level2">
<h2>Example Data: <code>Housing prices</code></h2>
<p>Let’s look at housing prices.</p>
<pre class="r"><code>housing &lt;- read.csv(&quot;dataSets/landdata-states.csv&quot;)
head(housing[1:5])</code></pre>
<pre><code>##   State region  Date Home.Value Structure.Cost
## 1    AK   West 20101     224952         160599
## 2    AK   West 20102     225511         160252
## 3    AK   West 20093     225820         163791
## 4    AK   West 20094     224994         161787
## 5    AK   West 20074     234590         155400
## 6    AK   West 20081     233714         157458</code></pre>
<p>(Data from <a href="https://www.lincolninst.edu/subcenters/land-values/land-prices-by-state.asp" class="uri">https://www.lincolninst.edu/subcenters/land-values/land-prices-by-state.asp</a>)</p>
</div>
<div id="ggplot2-vs-base-graphics" class="section level2">
<h2><code>ggplot2</code> VS Base Graphics</h2>
<p>Compared to base graphics, <code>ggplot2</code></p>
<ul>
<li>is more verbose for simple / canned graphics</li>
<li>is less verbose for complex / custom graphics</li>
<li>does not have methods (data should always be in a <code>data.frame</code>)</li>
<li>uses a different system for adding plot elements</li>
</ul>
</div>
<div id="ggplot2-vs-base-for-simple-graphs" class="section level2">
<h2><code>ggplot2</code> VS Base for simple graphs</h2>
<p>Base graphics histogram example:</p>
<pre class="r"><code>hist(housing$Home.Value)</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-2-1.png" title="" alt="" width="100%" /></p>
<p><code>ggplot2</code> histogram example:</p>
<pre class="r"><code>library(ggplot2)</code></pre>
<pre><code>## Loading required package: methods</code></pre>
<pre class="r"><code>ggplot(housing, aes(x = Home.Value)) +
  geom_histogram()</code></pre>
<pre><code>## stat_bin: binwidth defaulted to range/30. Use &#39;binwidth = x&#39; to adjust this.</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-3-1.png" title="" alt="" width="100%" /></p>
<p>Base wins!</p>
</div>
<div id="ggplot2-base-graphics-vs-ggplot-for-more-complex-graphs" class="section level2">
<h2><code>ggplot2</code> Base graphics VS <code>ggplot</code> for more complex graphs:</h2>
<p>Base colored scatter plot example:</p>
<pre class="r"><code>plot(Home.Value ~ Date,
     data=subset(housing, State == &quot;MA&quot;))
points(Home.Value ~ Date, col=&quot;red&quot;,
       data=subset(housing, State == &quot;TX&quot;))
legend(19750, 400000,
       c(&quot;MA&quot;, &quot;TX&quot;), title=&quot;State&quot;,
       col=c(&quot;black&quot;, &quot;red&quot;),
       pch=c(1, 1))</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-4-1.png" title="" alt="" width="100%" /></p>
<p><code>ggplot2</code> colored scatter plot example:</p>
<pre class="r"><code>ggplot(subset(housing, State %in% c(&quot;MA&quot;, &quot;TX&quot;)),
       aes(x=Date,
           y=Home.Value,
           color=State))+
  geom_point()</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-5-1.png" title="" alt="" width="100%" /></p>
<p><code>ggplot2</code> wins!</p>
</div>
</div>
<div id="aesthetics" class="section level1">
<h1>Aesthetics</h1>
<div id="aesthetic-mapping" class="section level2">
<h2>Aesthetic Mapping</h2>
<p>In ggplot land <em>aesthetic</em> means “something you can see”. Examples include:</p>
<ul>
<li>position (i.e., on the x and y axes)</li>
<li>color (“outside” color)</li>
<li>fill (“inside” color)</li>
<li>shape (of points)</li>
<li>linetype</li>
<li>size</li>
</ul>
<p>Each type of geom accepts only a subset of all aesthetics–refer to the geom help pages to see what mappings each geom accepts. Aesthetic mappings are set with the <code>aes()</code> function.</p>
</div>
<div id="geometic-objects-geom" class="section level2">
<h2>Geometic Objects (<code>geom</code>)</h2>
<p>Geometric objects are the actual marks we put on a plot. Examples include:</p>
<ul>
<li>points (<code>geom_point</code>, for scatter plots, dot plots, etc)</li>
<li>lines (<code>geom_line</code>, for time series, trend lines, etc)</li>
<li>boxplot (<code>geom_boxplot</code>, for, well, boxplots!)</li>
</ul>
<p>A plot must have at least one geom; there is no upper limit. You can add a geom to a plot using the <code>+</code> operator</p>
<p>You can get a list of available geometric objects using the code below:</p>
<pre class="r"><code>help.search(&quot;geom_&quot;, package = &quot;ggplot2&quot;)</code></pre>
<p>or simply type <code>geom_&lt;tab&gt;</code> in any good R IDE (such as Rstudio or ESS) to see a list of functions starting with <code>geom_</code>.</p>
</div>
<div id="points-scatterplot" class="section level2">
<h2>Points (Scatterplot)</h2>
<p>Now that we know about geometric objects and aesthetic mapping, we can make a ggplot. <code>geom_point</code> requires mappings for x and y, all others are optional.</p>
<pre class="r"><code>hp2001Q1 &lt;- subset(housing, Date == 20011) 
ggplot(hp2001Q1,
       aes(y = Structure.Cost, x = Land.Value)) +
  geom_point()</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-7-1.png" title="" alt="" width="100%" /></p>
</div>
<div id="lines-prediction-line" class="section level2">
<h2>Lines (Prediction Line)</h2>
<p>A plot constructed with <code>ggplot</code> can have more than one geom. In that case the mappings established in the <code>ggplot()</code> call are plot defaults that can be added to or overridden. Our plot could use a regression line:</p>
<pre class="r"><code>hp2001Q1$pred.SC &lt;- predict(lm(Structure.Cost ~ Land.Value, data = hp2001Q1))

p1 &lt;- ggplot(hp2001Q1, aes(x = Land.Value, y = Structure.Cost))

p1 + geom_point(aes(color = Home.Value)) +
  geom_line(aes(y = pred.SC))</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-8-1.png" title="" alt="" width="100%" /></p>
</div>
<div id="smoothers" class="section level2">
<h2>Smoothers</h2>
<p>Not all geometric objects are simple shapes–the smooth geom includes a line and a ribbon.</p>
<pre class="r"><code>p1 +
  geom_point(aes(color = Home.Value)) +
  geom_smooth()</code></pre>
<pre><code>## geom_smooth: method=&quot;auto&quot; and size of largest group is &lt;1000, so using loess. Use &#39;method = x&#39; to change the smoothing method.</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-9-1.png" title="" alt="" width="100%" /></p>
</div>
<div id="text-label-points" class="section level2">
<h2>Text (Label Points)</h2>
<p>Each <code>geom</code> accepts a particualar set of mappings–for example <code>geom_text()</code> accepts a <code>labels</code> mapping.</p>
<pre class="r"><code>p1 + 
  geom_text(aes(label = State), size = 2)</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-10-1.png" title="" alt="" width="100%" /></p>
</div>
<div id="aesthetic-mapping-vs-assignment" class="section level2">
<h2>Aesthetic Mapping VS Assignment</h2>
<p>Note that variables are mapped to aesthetics with the <code>aes()</code> function, while fixed aesthetics are set outside the <code>aes()</code> call. This sometimes leads to confusion, as in this example:</p>
<pre class="r"><code>p1 +
  geom_point(aes(size = 2),# incorrect! 2 is not a variable
             color = &quot;red&quot;) # this is fine -- all points red</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-11-1.png" title="" alt="" width="100%" /></p>
</div>
<div id="mapping-variables-to-other-aesthetics" class="section level2">
<h2>Mapping Variables To Other Aesthetics<a id="sec-2-8" name="sec-2-8"></a></h2>
<p>Other aesthetics are mapped in the same way as x and y in the previous example.</p>
<pre class="r"><code>p1 +
  geom_point(aes(color = Home.Value, shape = region))</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-12-1.png" title="" alt="" width="100%" /></p>
</div>
<div id="exercise-i" class="section level2">
<h2>Exercise I</h2>
<p>The data for the exercises is available in the <code>dataSets/EconomistData.csv</code> file. Read it in with</p>
<pre class="r"><code>dat &lt;- read.csv(&quot;dataSets/EconomistData.csv&quot;)</code></pre>
<p>Original sources for these data are <a href="http://www.transparency.org/content/download/64476/1031428" class="uri">http://www.transparency.org/content/download/64476/1031428</a> <a href="http://hdrstats.undp.org/en/indicators/display_cf_xls_indicator.cfm?indicator_id=103106&amp;lang=en" class="uri">http://hdrstats.undp.org/en/indicators/display_cf_xls_indicator.cfm?indicator_id=103106&amp;lang=en</a></p>
<p>These data consist of <em>Human Development Index</em> and <em>Corruption Perception Index</em> scores for several countries.</p>
<ol style="list-style-type: decimal">
<li>Create a scatter plot with CPI on the x axis and HDI on the y axis.</li>
<li>Color the points in the previous plot blue.</li>
<li>Color the points in the previous plot according to <em>Region</em>.</li>
<li>Create boxplots of CPI by Region</li>
<li>Overlay points on top of the box plots</li>
</ol>
</div>
</div>
<div id="transformations" class="section level1">
<h1>Transformations</h1>
<div id="statistical-transformations" class="section level2">
<h2>Statistical Transformations</h2>
<p>Some plot types (such as scatterplots) do not require transformations–each point is plotted at x and y coordinates equal to the original value. Other plots, such as boxplots, histograms, prediction lines etc. require statistical transformations:</p>
<ul>
<li>for a boxplot the y values must be transformed to the median and 1.5(IQR)</li>
<li>for a smoother smother the y values must be transformed into predicted values</li>
</ul>
<p>Each <code>geom</code> has a default statistic, but these can be changed. For example, the default statistic for <code>geom_bar</code> is <code>stat_bin</code>:</p>
<pre class="r"><code>args(geom_bar)</code></pre>
<pre><code>## function (mapping = NULL, data = NULL, stat = &quot;bin&quot;, position = &quot;stack&quot;, 
##     ...) 
## NULL</code></pre>
<pre class="r"><code># ?stat_bin</code></pre>
</div>
<div id="setting-statistical-transformation-arguments" class="section level2">
<h2>Setting Statistical Transformation Arguments</h2>
<p>Arguments to <code>stat_</code> functions can be passed through <code>geom_</code> functions. This can be slightly annoying because in order to change it you have to first determine which stat the geom uses, then determine the arguments to that stat.</p>
<p>For example, here is the default histogram of Home.Value:</p>
<pre class="r"><code>p2 &lt;- ggplot(housing, aes(x = Home.Value))
p2 + geom_bar()</code></pre>
<pre><code>## stat_bin: binwidth defaulted to range/30. Use &#39;binwidth = x&#39; to adjust this.</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-15-1.png" title="" alt="" width="100%" /></p>
<p>The binwidth looks reasonable by default, but we can change it by passing the <code>binwidth</code> argument to the <code>stat_bin</code> function:</p>
<pre class="r"><code>p2 + geom_bar(stat = &quot;bin&quot;, binwidth=4000)</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-16-1.png" title="" alt="" width="100%" /></p>
<p>If you’re thinking to yourself “this is crazy, there must be a better way” you can construct the same plot using <code>stat_bin</code> in place of geom<sub>bar</sub>, like this:</p>
<pre class="r"><code>p2 + stat_bin(binwidth = 9000, geom = &quot;bar&quot;)</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-17-1.png" title="" alt="" width="100%" /></p>
<p>but I prefer to construct my layers with <code>geom_</code> calls rather than <code>stat_</code> calls.</p>
</div>
<div id="changing-the-statistical-transformation" class="section level2">
<h2>Changing The Statistical Transformation</h2>
<p>Sometimes the default statistical transformation is not what you need. This is often the case with pre-summarized data:</p>
<pre class="r"><code>housing.sum &lt;- aggregate(housing[&quot;Home.Value&quot;], housing[&quot;State&quot;], FUN=mean)
rbind(head(housing.sum), tail(housing.sum))</code></pre>
<pre><code>##    State Home.Value
## 1     AK  147385.14
## 2     AL   92545.22
## 3     AR   82076.84
## 4     AZ  140755.59
## 5     CA  282808.08
## 6     CO  158175.99
## 46    VA  155391.44
## 47    VT  132394.60
## 48    WA  178522.58
## 49    WI  108359.45
## 50    WV   77161.71
## 51    WY  122897.25</code></pre>
<pre class="r"><code>ggplot(housing.sum, aes(x = State, y = Home.Value)) + 
  geom_bar()</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-18-1.png" title="" alt="" width="100%" /></p>
<pre class="r"><code>ggplot(housing.sum, aes(x = State, y = Home.Value)) + 
  geom_bar()</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-18-2.png" title="" alt="" width="100%" /></p>
<p>What is the problem with the previous plot? Basically we take binned and summarized data and ask ggplot to bin and summarize it again (remember, <code>geom_bar</code> defaults to <code>stat = stat_bin</code>); obviously this will not work. We can fix it by telling <code>geom_bar</code> to use a different statistical transformation function:</p>
<pre class="r"><code>ggplot(housing.sum, aes(x = State, y = Home.Value)) + 
      geom_bar(stat = &quot;identity&quot;)</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-19-1.png" title="" alt="" width="100%" /></p>
</div>
<div id="exercise-ii" class="section level2">
<h2>Exercise II</h2>
<ol style="list-style-type: decimal">
<li>Re-create a scatter plot with CPI on the x axis and HDI on the y axis (as you did in the previous exercise).</li>
<li>Overlay a smoothing line on top of the scatter plot using the <em>lm</em> method. Hint: see <code>?stat_smooth</code>.</li>
<li>Overlay a smoothing line on top of the scatter plot using the default <em>loess</em> method.</li>
<li>BONUS (optional): Overlay a smoothing line on top of the scatter plot using the default <em>loess</em> method, but make it less smooth. Hint: see <code>?loess</code>.</li>
</ol>
</div>
</div>
<div id="scales" class="section level1">
<h1>Scales</h1>
<div id="scales-controlling-aesthetic-mapping" class="section level2">
<h2>Scales: Controlling Aesthetic Mapping</h2>
<p>Aesthetic mapping (i.e., with <code>aes()</code>) only says that a variable should be mapped to an aesthetic. It doesn’t say <em>how</em> that should happy. For example, when mapping a variable to <em>shape</em> with <code>aes(shape = x)</code> you don’t say <em>what</em> shapes should be used. Similarly, <code>aes(color = z)</code> doesn’t say <em>what</em> colors should be used. Describing what colors/shapes/sizes etc. to use is done by modifying the corresponding <em>scale</em>. In <code>ggplot2</code> scales include</p>
<ul>
<li>position</li>
<li>color and fill</li>
<li>size</li>
<li>shape</li>
<li>line type</li>
</ul>
<p>Scales are modified with a series of functions using a <code>scale_&lt;aesthetic&gt;_&lt;type&gt;</code> naming scheme. Try typing <code>scale_&lt;tab&gt;</code> to see a list of scale modification functions.</p>
</div>
<div id="common-scale-arguments" class="section level2">
<h2>Common Scale Arguments</h2>
<p>The following arguments are common to most scales in ggplot2:</p>
<ul>
<li><strong>name:</strong> the first argument gives the axis or legend title</li>
<li><strong>limits:</strong> the minimum and maximum of the scale</li>
<li><strong>breaks:</strong> the points along the scale where labels should appear</li>
<li><strong>labels:</strong> the labels that appear at each break</li>
</ul>
<p>Specific scale functions may have additional arguments; for example, the <code>scale_color_continuous</code> function has arguments <code>low</code> and <code>high</code> for setting the colors at the low and high end of the scale.</p>
</div>
<div id="scale-modification-examples" class="section level2">
<h2>Scale Modification Examples</h2>
<p>Start by constructing a dotplot showing the distribution of home values by Date and State.</p>
<pre class="r"><code>p3 &lt;- ggplot(housing,
             aes(x = State,
                 y = Home.Price.Index)) + 
  theme(legend.position=&quot;top&quot;,
        axis.text=element_text(size = 6))
(p4 &lt;- p3 + geom_point(aes(color = Date),
                       alpha = 0.5,
                       size = 1.5,
                       position = position_jitter(width = 0.25, height = 0)))</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-20-1.png" title="" alt="" width="100%" /></p>
<p>Now modify the breaks and labels for the x axis and color scales</p>
<pre class="r"><code>p4 + scale_x_discrete(name = &quot;State Abbreviation&quot;) +
  scale_color_continuous(name = &quot;&quot;,
                         breaks = c(19751, 19941, 20131),
                         labels = c(1971, 1994, 2013))</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-21-1.png" title="" alt="" width="100%" /></p>
<p>Next change the low and high values to blue and red:</p>
<pre class="r"><code>p4 +
  scale_x_discrete(name = &quot;State Abbreviation&quot;) +
  scale_color_continuous(name = &quot;&quot;,
                         breaks = c(19751, 19941, 20131),
                         labels = c(1971, 1994, 2013),
                         low = &quot;blue&quot;, high = &quot;red&quot;)</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-22-1.png" title="" alt="" width="100%" /></p>
<pre class="r"><code>p4 +
  scale_color_continuous(name = &quot;&quot;,
                         breaks = c(19751, 19941, 20131),
                         labels = c(1971, 1994, 2013),
                         low = scales::muted(&quot;blue&quot;), high = scales::muted(&quot;red&quot;))</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-22-2.png" title="" alt="" width="100%" /></p>
</div>
<div id="using-different-color-scales" class="section level2">
<h2>Using different color scales</h2>
<p>ggplot2 has a wide variety of color scales; here is an example using <code>scale_color_gradient2</code> to interpolate between three different colors.</p>
<pre class="r"><code>p4 +
  scale_color_gradient2(name = &quot;&quot;,
                        breaks = c(19751, 19941, 20131),
                        labels = c(1971, 1994, 2013),
                        low = scales::muted(&quot;blue&quot;),
                        high = scales::muted(&quot;red&quot;),
                        mid = &quot;gray60&quot;,
                        midpoint = 19941)</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-23-1.png" title="" alt="" width="100%" /></p>
</div>
<div id="available-scales" class="section level2">
<h2>Available Scales</h2>
<ul>
<li>Partial combination matrix of available scales</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col  class="left" />
<col  class="left" />
<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">
<strong>Scale</strong>
</th>
<th scope="col" class="left">
<strong>Types</strong>
</th>
<th scope="col" class="left">
<strong>Examples</strong>
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">
scale<sub>color</sub>_
</td>
<td class="left">
identity
</td>
<td class="left">
scale<sub>fill</sub><sub>continuous</sub>
</td>
</tr>
<tr>
<td class="left">
scale<sub>fill</sub>_
</td>
<td class="left">
manual
</td>
<td class="left">
scale<sub>color</sub><sub>discrete</sub>
</td>
</tr>
<tr>
<td class="left">
scale<sub>size</sub>_
</td>
<td class="left">
continuous
</td>
<td class="left">
scale<sub>size</sub><sub>manual</sub>
</td>
</tr>
<tr>
<td class="left">
 
</td>
<td class="left">
discrete
</td>
<td class="left">
scale<sub>size</sub><sub>discrete</sub>
</td>
</tr>
<tr>
<td class="left">
 
</td>
<td class="left">
 
</td>
<td class="left">
 
</td>
</tr>
<tr>
<td class="left">
scale<sub>shape</sub>_
</td>
<td class="left">
discrete
</td>
<td class="left">
scale<sub>shape</sub><sub>discrete</sub>
</td>
</tr>
<tr>
<td class="left">
scale<sub>linetype</sub>_
</td>
<td class="left">
identity
</td>
<td class="left">
scale<sub>shape</sub><sub>manual</sub>
</td>
</tr>
<tr>
<td class="left">
 
</td>
<td class="left">
manual
</td>
<td class="left">
scale<sub>linetype</sub><sub>discrete</sub>
</td>
</tr>
<tr>
<td class="left">
 
</td>
<td class="left">
 
</td>
<td class="left">
 
</td>
</tr>
<tr>
<td class="left">
scale<sub>x</sub>_
</td>
<td class="left">
continuous
</td>
<td class="left">
scale<sub>x</sub><sub>continuous</sub>
</td>
</tr>
<tr>
<td class="left">
scale<sub>y</sub>_
</td>
<td class="left">
discrete
</td>
<td class="left">
scale<sub>y</sub><sub>discrete</sub>
</td>
</tr>
<tr>
<td class="left">
 
</td>
<td class="left">
reverse
</td>
<td class="left">
scale<sub>x</sub><sub>log</sub>
</td>
</tr>
<tr>
<td class="left">
 
</td>
<td class="left">
log
</td>
<td class="left">
scale<sub>y</sub><sub>reverse</sub>
</td>
</tr>
<tr>
<td class="left">
 
</td>
<td class="left">
date
</td>
<td class="left">
scale<sub>x</sub><sub>date</sub>
</td>
</tr>
<tr>
<td class="left">
 
</td>
<td class="left">
datetime
</td>
<td class="left">
scale<sub>y</sub><sub>datetime</sub>
</td>
</tr>
</tbody>
</table>
</div>
<div id="exercise-ii-1" class="section level2">
<h2>Exercise II</h2>
<ol style="list-style-type: decimal">
<li>Create a scatter plot with CPI on the x axis and HDI on the y axis. Color the points to indicate region.</li>
<li>Modify the x, y, and color scales so that they have more easily-understood names (e.g., spell out “Human development Index” instead of “HDI”).</li>
<li>Modify the color scale to use specific values of your choosing. Hint: see <code>?scale_color_manual</code>.</li>
</ol>
</div>
</div>
<div id="faceting" class="section level1">
<h1>Faceting</h1>
<div id="faceting-1" class="section level2">
<h2>Faceting</h2>
<ul>
<li>Faceting is <code>ggplot2</code> parlance for <strong>small multiples</strong></li>
<li>The idea is to create separate graphs for subsets of data</li>
<li><code>ggplot2</code> offers two functions for creating small multiples:
<ol style="list-style-type: decimal">
<li><code>facet_wrap()</code>: define subsets as the levels of a single grouping variable</li>
<li><code>facet_grid()</code>: define subsets as the crossing of two grouping variables</li>
</ol></li>
<li>Facilitates comparison among plots, not just of geoms within a plot</li>
</ul>
</div>
<div id="what-is-the-trend-in-housing-prices-in-each-state" class="section level2">
<h2>What is the trend in housing prices in each state?</h2>
<ul>
<li>Start by using a technique we already know (map State to color):</li>
</ul>
<pre class="r"><code>p5 &lt;- ggplot(housing, aes(x = Date, y = Home.Value))
p5 + geom_line(aes(color = State))</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-24-1.png" title="" alt="" width="100%" /></p>
<p>There are two problems here: - there are too many states to distinguish each one by color - lines obscure one another.</p>
</div>
<div id="faceting-to-the-rescue" class="section level2">
<h2>Faceting to the rescue</h2>
<p>We can remedy the deficiencies of the previous plot by faceting by state rather than mapping state to color.</p>
<pre class="r"><code>(p5 &lt;- p5 + geom_line() +
   facet_wrap(~State, ncol = 10))</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-25-1.png" title="" alt="" width="100%" /></p>
<p>There is also a <code>facet_grid()</code> function for faceting in two dimensions.</p>
</div>
</div>
<div id="themes" class="section level1">
<h1>Themes</h1>
<div id="themes-1" class="section level2">
<h2>Themes</h2>
<p>The <code>ggplot2</code> theme system handles non-data plot elements such as</p>
<ul>
<li>Axis labels</li>
<li>Plot background</li>
<li>Facet label backround</li>
<li>Legend appearance</li>
</ul>
<p>Built-in themes include:</p>
<ul>
<li><code>theme_gray()</code> (default)</li>
<li><code>theme_bw()</code></li>
<li><code>theme_classc()</code></li>
</ul>
<pre class="r"><code>p5 + theme_linedraw()</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-26-1.png" title="" alt="" width="100%" /></p>
</div>
<div id="overriding-theme-defaults" class="section level2">
<h2>Overriding theme defaults</h2>
<p>Specific theme elements can be overridden using <code>theme()</code>. For example:</p>
<pre class="r"><code>p5 + theme_minimal()</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-27-1.png" title="" alt="" width="100%" /></p>
<p>All theme options are documented in <code>?theme</code>.</p>
</div>
<div id="creating-and-saving-new-themes" class="section level2">
<h2>Creating and saving new themes</h2>
<p>You can create new themes, as in the following example:</p>
<pre class="r"><code>theme_new &lt;- theme_bw() +
  theme(text=element_text(size = 12, family = &quot;&quot;),
        axis.text.y = element_text(colour = &quot;purple&quot;),
        axis.text.x = element_text(colour = &quot;red&quot;),
        panel.background = element_rect(fill = &quot;pink&quot;),
        strip.background = element_rect(fill = scales:::muted(&quot;orange&quot;)))

p5 + theme_new</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-28-1.png" title="" alt="" width="100%" /></p>
</div>
</div>
<div id="the-1-faq" class="section level1">
<h1>The #1 FAQ</h1>
<div id="map-aesthetic-to-different-columns" class="section level2">
<h2>Map Aesthetic To Different Columns</h2>
<p>The most frequently asked question goes something like this: <em>I have two variables in my data.frame, and I’d like to plot them as separate points, with different color depending on which variable it is. How do I do that?</em></p>
<ol style="list-style-type: decimal">
<li>Wrong</li>
</ol>
<pre class="r"><code>housing.byyear &lt;- aggregate(cbind(Home.Value, Land.Value) ~ Date, data = housing, mean)
head(housing.byyear)</code></pre>
<pre><code>##    Date Home.Value Land.Value
## 1 19751   31147.47   4503.784
## 2 19752   31695.22   4611.118
## 3 19753   32246.16   4764.529
## 4 19754   32839.35   4943.176
## 5 19761   33499.86   5082.686
## 6 19762   34164.84   5161.353</code></pre>
<pre class="r"><code>ggplot(housing.byyear,
       aes(x = Date)) +
  geom_line(aes(y = Home.Value), color = &quot;red&quot;) +
  geom_line(aes(y = Land.Value), color = &quot;blue&quot;)</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-29-1.png" title="" alt="" width="100%" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Right</li>
</ol>
<pre class="r"><code>library(tidyr)
home.land.byyear &lt;- gather(housing.byyear,
                           value = &quot;value&quot;,
                           key = &quot;type&quot;,
                           Home.Value, Land.Value)
head(home.land.byyear)</code></pre>
<pre><code>##    Date       type    value
## 1 19751 Home.Value 31147.47
## 2 19752 Home.Value 31695.22
## 3 19753 Home.Value 32246.16
## 4 19754 Home.Value 32839.35
## 5 19761 Home.Value 33499.86
## 6 19762 Home.Value 34164.84</code></pre>
<pre class="r"><code>ggplot(home.land.byyear,
       aes(x = Date,
           y = value,
           color = type)) +
  geom_line()</code></pre>
<p><img src="data_visualization_files/figure-html/unnamed-chunk-30-1.png" title="" alt="" width="100%" /></p>
</div>
</div>
<div id="dynamic" class="section level1">
<h1>Dynamic</h1>
<div id="a-growing-number-of-libraries" class="section level2">
<h2>A growing number of libraries</h2>
<ul>
<li>ggvis</li>
<li>htmlwidgets</li>
</ul>
</div>
</div>
<div id="putting-it-all-together" class="section level1">
<h1>Putting It All Together</h1>
<div id="challenge-recreate-this-economist-graph" class="section level2">
<h2>Challenge: Recreate This <code>Economist</code> Graph</h2>
<p><images/Economist1.pdf></p>
<p>Graph source: <a href="http://www.economist.com/node/21541178" class="uri">http://www.economist.com/node/21541178</a></p>
<p>Building off of the graphics you created in the previous exercises, put the finishing touches to make it as close as possible to the original economist graph.</p>
<p><img src="images/Economist1.png" alt="img" /></p>
</div>
</div>
<div id="challenge-solution" class="section level1">
<h1>Challenge Solution</h1>
<p>Create basic scatter plot</p>
<pre><code>  pc1 &lt;- ggplot(dat, aes(x = CPI, y = HDI, color = Region))
  (pc1 &lt;- pc1 + geom_point(shape = 1))</code></pre>
<div id="challenge-solution-1" class="section level2">
<h2>Challenge Solution</h2>
<p>Add labels</p>
<pre><code>label.these &lt;- c(&quot;Congo&quot;, &quot;Sudan&quot;, &quot;Afghanistan&quot;, &quot;Greece&quot;, &quot;China&quot;,
                 &quot;India&quot;, &quot;Rwanda&quot;, &quot;Spain&quot;, &quot;France&quot;, &quot;United States&quot;,
                 &quot;Japan&quot;, &quot;Norway&quot;, &quot;Singapore&quot;)
(pc2 &lt;- pc1 +
 geom_text(aes(label = Country),
           color = &quot;black&quot;, size = 3, hjust = 1.1,
           data = dat[dat$Country %in% label.these, ]))</code></pre>
</div>
<div id="challenge-solution-2" class="section level2">
<h2>Challenge Solution</h2>
<p>Add smoothing line</p>
<pre><code>  (pc3 &lt;- pc2 +
   geom_smooth(aes(group = 1),
               method = &quot;lm&quot;,
               color = &quot;black&quot;,
               formula = y~ poly(x, 2),
               se = FALSE))
#</code></pre>
</div>
<div id="challenge-solution-3" class="section level2">
<h2>Challenge Solution</h2>
<p>Finishing touches</p>
<pre><code>(pc4 &lt;- pc3 + theme_bw() +
  scale_x_continuous(&quot;Corruption Perceptions Index, 2011\n(10 = least corrupt)&quot;) +
  scale_y_continuous(&quot;Human Development Index, 2011\n(1 = best)&quot;) +
  theme(legend.position = &quot;top&quot;, legend.direction = &quot;horizontal&quot;))</code></pre>
</div>
</div>
<div id="wrap-up" class="section level1">
<h1>Wrap-up</h1>
<div id="additional-resources" class="section level2">
<h2>Additional resources</h2>
<ul>
<li>ggplot2 resources
<ul>
<li>Mailing list: <a href="http://groups.google.com/group/ggplot2" class="uri">http://groups.google.com/group/ggplot2</a></li>
<li>Wiki: <a href="https://github.com/hadley/ggplot2/wiki" class="uri">https://github.com/hadley/ggplot2/wiki</a></li>
<li>Website: <a href="http://had.co.nz/ggplot2/" class="uri">http://had.co.nz/ggplot2/</a></li>
<li>StackOverflow: <a href="http://stackoverflow.com/questions/tagged/ggplot" class="uri">http://stackoverflow.com/questions/tagged/ggplot</a></li>
</ul></li>
<li>IQSS resources
<ul>
<li>Research technology consulting: <a href="http://projects.iq.harvard.edu/rtc" class="uri">http://projects.iq.harvard.edu/rtc</a></li>
<li>Workshops: <a href="http://projects.iq.harvard.edu/rtc/filter_by/workshops" class="uri">http://projects.iq.harvard.edu/rtc/filter_by/workshops</a></li>
</ul></li>
</ul>
</div>
</div>

<footer>
<p><small>Christine Choirat<br/>
P01 - Advanced R<br/>
Harvard T.H Chan School of Public Health <a>http://www.hsph.harvard.edu/</a>
</small></p>
</footer>

  </div>
</div>

<a href="https://github.com/p01r/p01r"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
